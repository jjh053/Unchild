<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PC Manufacturing Process Monitor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }

        header {
            background-color: #333;
            color: white;
            padding: 10px;
            text-align: center;
        }

        #total-defect-rate-section {
            background-color: #555;
            /* Slightly darker than the header for distinction */
            color: white;
            padding: 10px 0;
            text-align: center;
        }

        .total-defect-rate-display {
            font-family: Arial, sans-serif;
            font-size: 18px;
            font-weight: bold;
            margin: 0 auto;
            padding: 5px;
            width: calc(100% - 40px);
            /* Assuming you want some padding on the sides */
        }

        #monitoring {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            padding: 20px;
        }

        .process {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 20px;
            width: 300px;
            background-color: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .operations {
            margin-top: 10px;
            background-color: #eef;
            padding: 5px;
            border-radius: 5px;
            text-align: center;
        }

        .process h2 {
            margin-top: 0;
        }

        .status {
            font-weight: bold;
        }

        .status::before {
            content: '🔴';
            margin-right: 5px;
        }

        #cpu-status::before,
        #gpu-status::before,
        #case-status::before {
            content: '🟢';
        }

        #graph-title {
            text-align: center;
            margin: 20px 0;
        }


        .graph-container {
            position: relative;
            margin: 20px auto;
            width: 80%;
            height: 500px;
            background-color: #f9f9f9;
            border: 1px solid #ccc;
            border-radius: 5px;
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .graph-container::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 0;
            background-image: repeating-linear-gradient(to bottom,
                    transparent,
                    transparent 98%,
                    #ddd 98%,
                    #ddd 100%);
            background-size: 100% 20%;
        }

        .bar {
            width: 20%;
            height: 0%;
            background-color: #3498DB;
            color: 555;
            text-align: center;
            border-radius: 5px;
            transition: height 0.3s ease-in-out;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding: 5px;
            z-index: 2;
        }
    </style>
</head>

<body>
    <header>
        <h1>모니터링 인터페이스</h1>
    </header>
    <section id="total-defect-rate-section">
        <div id="total-defect-rate" class="total-defect-rate-display">총 불량률: 0%</div>
    </section>
    <section id="monitoring">
        <div class="process">
            <h2>CPU 장착</h2>
            <div id="cpu-status" class="status">Status: Pending</div>
            <div id="cpu-operations" class="operations">가동 횟수: 0</div>
            <div id="cpu-defect-rate" class="operations">불량률: 0%</div>
            <div id="cpu-defect-count" class="operations">불량: 0</div>
            <div id="cpu-good-count" class="operations">통과: 0</div>
        </div>
        <div class="process">
            <h2>GPU 장착</h2>
            <div id="gpu-status" class="status">Status: Pending</div>
            <div id="gpu-operations" class="operations">가동 횟수: 0</div>
            <div id="gpu-defect-rate" class="operations">불량률: 0%</div>
            <div id="gpu-defect-count" class="operations">불량: 0</div>
            <div id="gpu-good-count" class="operations">통과: 0</div>
        </div>
        <div class="process">
            <h2>메인보드 케이스 장착</h2>
            <div id="case-status" class="status">Status: Pending</div>
            <div id="case-operations" class="operations">가동 횟수: 0</div>
            <div id="case-defect-rate" class="operations">불량률: 0%</div>
            <div id="case-defect-count" class="operations">불량: 0</div>
            <div id="case-good-count" class="operations">통과: 0</div>
        </div>
    </section>
    <h2 id="graph-title">불량률 그래프</h2>
    <div id="defect-rate-graph" class="graph-container">
        <div id="cpu-bar" class="bar">CPU</div>
        <div id="gpu-bar" class="bar">GPU</div>
        <div id="case-bar" class="bar">Case</div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const cpuStatus = document.getElementById('cpu-status');
            const cpuOperations = document.getElementById('cpu-operations');
            const gpuStatus = document.getElementById('gpu-status');
            const gpuOperations = document.getElementById('gpu-operations');
            const caseStatus = document.getElementById('case-status');
            const caseOperations = document.getElementById('case-operations');
            const cpuDefectRateElement = document.getElementById('cpu-defect-rate');
            const gpuDefectRateElement = document.getElementById('gpu-defect-rate');
            const caseDefectRateElement = document.getElementById('case-defect-rate');
            const cpuDefectCountElement = document.getElementById('cpu-defect-count');
            const gpuDefectCountElement = document.getElementById('gpu-defect-count');
            const caseDefectCountElement = document.getElementById('case-defect-count');
            const cpuGoodCountElement = document.getElementById('cpu-good-count');
            const gpuGoodCountElement = document.getElementById('gpu-good-count');
            const caseGoodCountElement = document.getElementById('case-good-count');
            const totalDefectRateElement = document.getElementById('total-defect-rate');

            let cpuOperationsCount = 0;
            let gpuOperationsCount = 0;
            let caseOperationsCount = 0;
            let cpuDefectCount = 0;
            let gpuDefectCount = 0;
            let caseDefectCount = 0;
            let iteration = 0;
            const maxIterations = 100;

            function simulateDefects(defectRate) {
                return Math.random() < defectRate ? 1 : 0;
            }

            function calculateDefectRate(operationsCount, defectCount) {
                if (operationsCount === 0) return "0.00";
                const rate = (defectCount / operationsCount) * 100;
                return rate.toFixed(2);
            }

            function calculateTotalDefectRate() {
                const totalOperations = cpuOperationsCount + gpuOperationsCount + caseOperationsCount;
                const totalDefects = cpuDefectCount + gpuDefectCount + caseDefectCount;
                if (totalOperations === 0) return "0.00";
                const rate = (totalDefects / totalOperations) * 100;
                return rate.toFixed(2);
            }

            function updateCountsAndRates() {
                // CPU
                cpuOperations.textContent = `가동 횟수: ${cpuOperationsCount}`;
                cpuDefectCountElement.textContent = `불량: ${cpuDefectCount}`;
                cpuGoodCountElement.textContent = `통과: ${Math.max(0, cpuOperationsCount - cpuDefectCount)}`;
                cpuDefectRateElement.textContent = `불량률: ${calculateDefectRate(cpuOperationsCount, cpuDefectCount)}%`;

                // GPU
                gpuOperations.textContent = `가동 횟수: ${gpuOperationsCount}`;
                gpuDefectCountElement.textContent = `불량: ${gpuDefectCount}`;
                gpuGoodCountElement.textContent = `통과: ${Math.max(0, gpuOperationsCount - gpuDefectCount)}`;
                gpuDefectRateElement.textContent = `불량률: ${calculateDefectRate(gpuOperationsCount, gpuDefectCount)}%`;

                // Case
                caseOperations.textContent = `가동 횟수: ${caseOperationsCount}`;
                caseDefectCountElement.textContent = `불량: ${caseDefectCount}`;
                caseGoodCountElement.textContent = `통과: ${Math.max(0, caseOperationsCount - caseDefectCount)}`;
                caseDefectRateElement.textContent = `불량률: ${calculateDefectRate(caseOperationsCount, caseDefectCount)}%`;

                // total
                totalDefectRateElement.textContent = `총 불량률: ${calculateTotalDefectRate()}%`;

                const cpuDefectRate = calculateDefectRate(cpuOperationsCount, cpuDefectCount);
                const gpuDefectRate = calculateDefectRate(gpuOperationsCount, gpuDefectCount);
                const caseDefectRate = calculateDefectRate(caseOperationsCount, caseDefectCount);

                document.getElementById('cpu-bar').style.height = `${cpuDefectRate}%`;
                document.getElementById('gpu-bar').style.height = `${gpuDefectRate}%`;
                document.getElementById('case-bar').style.height = `${caseDefectRate}%`;

                document.getElementById('cpu-bar').textContent = `CPU: ${cpuDefectRate}%`;
                document.getElementById('gpu-bar').textContent = `GPU: ${gpuDefectRate}%`;
                document.getElementById('case-bar').textContent = `Case: ${caseDefectRate}%`;

            }

            function runProcess() {
                if (iteration < maxIterations) {
                    // Run CPU process
                    cpuStatus.textContent = 'Status: Running';
                    cpuStatus.style.color = 'red';
                    setTimeout(() => {
                        cpuStatus.textContent = 'Status: Completed';
                        cpuStatus.style.color = 'green';
                        cpuOperationsCount++;
                        cpuDefectCount += simulateDefects(0.01);  // cpu 불량률 1%

                        // Run GPU process
                        gpuStatus.textContent = 'Status: Running';
                        gpuStatus.style.color = 'red';
                        setTimeout(() => {
                            gpuStatus.textContent = 'Status: Completed';
                            gpuStatus.style.color = 'green';
                            gpuOperationsCount++;
                            gpuDefectCount += simulateDefects(0.03);  // gpu 불량률 3%

                            // Run Case process
                            caseStatus.textContent = 'Status: Running';
                            caseStatus.style.color = 'red';
                            setTimeout(() => {
                                caseStatus.textContent = 'Status: Completed';
                                caseStatus.style.color = 'green';
                                caseOperationsCount++;
                                caseDefectCount += simulateDefects(0.05);  // 케이스 불량률 5%

                                updateCountsAndRates();

                                iteration++;
                                runProcess();

                            }, 30);
                        }, 30);
                    }, 30);
                }
            }

            runProcess();
        });
    </script>
</body>

</html>